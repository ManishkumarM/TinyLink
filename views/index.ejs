<!DOCTYPE html>
<html>

<head>
    <title>TinyLink — Dashboard</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="/js/main.js" defer></script>
</head>

<body>

    <div class="container my-5">

        <h1 class="text-center mb-4">TinyLink Dashboard</h1>

        <!-- Status -->
        <div id="status-box"></div>

        <!-- Add Link Form -->
        <div class="card p-4 mb-5 shadow-sm">
            <h4>Add New Short Link</h4>

            <form onsubmit="createLink(event)">
                <div class="mb-3">
                    <label>Original URL</label>
                    <input id="original_url" class="form-control" placeholder="https://example.com/page">
                </div>

                <div class="mb-3">
                    <label>Custom Code (optional)</label>
                    <input id="short_code" class="form-control" placeholder="6–8 alphanumeric">
                </div>

                <button class="btn btn-primary w-100">Create Short Link</button>
            </form>
        </div>

        <!-- Links Table -->
        <div class="card p-3 shadow-sm">
            <h4>Your Links</h4>

            <div class="mb-3">
                <input id="searchBox" class="form-control" placeholder="Search by code or URL…" onkeyup="filterLinks()">
            </div>


            <% if (links.length===0) { %>
                <p class="text-muted">No links created yet.</p>
                <% } else { %>
                    <table class="table table-hover mt-3">
                        <thead>
                            <tr>
                                <th>Short</th>
                                <th>Original URL</th>
                                <th>Clicks</th>
                                <th>Last Click</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% links.forEach(link=> { %>
                                <tr>
                                    <td>
                                        <a href="/<%= link.short_code %>" target="_blank">
                                            /<%= link.short_code %>
                                        </a>
                                    </td>

                                    <td class="text-truncate" style="max-width: 250px;">
                                        <%= link.original_url %>
                                    </td>

                                    <td>
                                        <%= link.clicks %>
                                    </td>

                                    <td>
                                        <%= link.updated_at ? link.updated_at.toLocaleString() : "—" %>
                                    </td>

                                    <td>
                                        <a href="/code/<%= link.short_code %>"
                                            class="btn btn-sm btn-secondary">Stats</a>

                                        <button onclick="deleteLink('<%= link.short_code %>')"
                                            class="btn btn-sm btn-danger">
                                            Delete
                                        </button>
                                    </td>
                                </tr>
                                <% }) %>
                        </tbody>
                    </table>
                    <% } %>

        </div>

    </div>

</body>

</html>